#  Blockchains
### Centralized Ledger

- Used by traditional banking systems. The bank is the trusted third party. 
## Decentralized Ledger (over a P2P network)

- All nodes have a copy of the ledger and ensure local correctness

**Pros:**
- No single point of failure
- Better reliability since network can handle some nodes going down
- Better security since some nodes can be malicious but the rest of the network has legitimate ledger
**Cons:**
- Harder to authenticate users
- Consistency is harder because of P2P

We use public-key cryptography and a digital signature where:
- The public key is the identity
- The signature is the authentication mechanism

### Solving Consistency Problems

##### Naive - Flood Routing Algorithm

When receiving a transaction, forward it to all connected peers. 
- A transaction will take time to broadcast on the network and during that time an attacker can do a **double spending attack**

**Double Spending Attack**: Broadcasting two conflicting transactions to distant nodes in the network.
## Blockchain Solution

Have the network "agree" at some set interval about some snapshot of the valid transactions so far. This snapshot is called a *block*.
- All transactions are verified and accepted into a *mempool* of unconfirmed transactions 
- Every $t$ seconds, "the network selects one node" to create a block of confirmed transactions 
- The block is chained to the previous one 
- That block is broadcasted to the network and each node checks whether this block is valid
###### What is a mempool?

An abbreviation for "memory pool." A mempool is a temporary holding area for unconfirmed transactions. 

1. Transaction is sent from a Bitcoin wallet
2. Transaction enters the mempool
3. A Bitcoin miner picks up the transaction from the mempool and includes it in a new block. 
	1. Miners are responsible for verifying transactions and bundling them into blocks, which are then added to the blockchain.

**A remaining problem:** Figuring out how the network should agree on which node should create and broadcast the block. 
### Types of Blockchains

[Reference](https://www.nervos.org/knowledge-base/utxo_vs_account_based)

Bank transactions (account-based) vs. cash transactions (UTXO model).
#### Account-based Blockchains

In traditional bank transfers, money transfers are recorded as debits and credits on different users' accounts on the bank's ledger.

Account-based blockchains do the exact same thing but with a ledger distributed across many nodes. 

**Don't track coins but track balance changes**
- There is a notion of identity
- One user is associated with a single blockchain account or address

Transactions must be processed sequentially. 
#### Coin-based Blockchains (UTXO)

**UTXO**: Unspent Transaction Output

Works like cash, the ledger's state is represented by a set of UTXOs. Each UTXO is an indivisible unit of cryptocurrency that can be spent in future transactions.

Each UTXO is associated with a specific owner's public key and can only be spent by providing a valid signature corresponding to that public key.

Transactions consist of inputs and outputs. Where:
- Inputs are the existing UTXOs that are consumed
- Outputs are the outstanding unspent coins. These are generated by the transaction. 

Allows for the parallel processing of transactions.

No concept of on-chain identity. 
# Key Management with Crypto Wallets

## ECC

[Reference](https://blog.cloudflare.com/a-relatively-easy-to-understand-primer-on-elliptic-curve-cryptography/)
##### TLDR

**Elliptic Curve Cryptography (ECC)** is the next generation of public key cryptography and, based on currently understood mathematics, provides a significantly more secure foundation than first generation public key cryptography systems like RSA.
- ECC is what's used to prove ownership of bitcoins

**Trap Door Functions**: A set of algorithms that is easy to process in one direction, but difficult to undo. The foundation of a good public key cryptography system.
#### RSA 

In RSA, this maximum value (call it _max_) is obtained by multiplying two random prime numbers. The public and private keys are two specially chosen numbers that are greater than zero and less than the maximum value, call them _pub_ and _priv_. To encrypt a number you multiply it by itself _pub_ times, making sure to wrap around when you hit the maximum. To decrypt a message, you multiply it by itself _priv_ times and you get back to the original number.

# Some important **B**itcoin **I**mprovement **P**roposals (**BIP**) 

## BIP 39: Seeds and Mnemonic Codes

Generates a 512 bit seed from a mnemonic phrase. 
- Each word comes from a wordlist of 2048 words with some useful properties to make memorizing sentences easier. 
- There are 11 bits per word
- There is also an optional passphrase
## BIP 32: Deriving child keys from a master key using a tree-like structures

![[HD Wallets.png]]

A hierarchical deterministic wallet (or "HD Wallet") is a wallet that generates all of its keys and addresses from a single source.

- **Hierarchical** – The keys and addresses can be organized into a _tree_.
- **Deterministic** – The keys and addresses are always generated in the _same way_.
## BIP 44: 

BIP 44 keys are derived from a BIP39 mnemonic phrase and a BIP32 key derivation path. A BIP 44 path has the following structure:

```
m / purpose' / cointype' / account' / change / address_index
```


